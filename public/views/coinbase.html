
<div
  class="topbar-container"
  ng-include="'views/includes/topbar.html'"
  ng-init="titleSection='Buy & Sell Bitcoin'; closeToHome = true; noColor = true">
</div>


<div class="content coinbase p20b" ng-controller="coinbaseController as coinbase">

  <div class="onGoingProcess" ng-show="coinbase.loading || index.coinbaseLoading">
    <div class="onGoingProcess-content" ng-style="{'background-color': '#2b71b1'}">
    <div class="spinner">
      <div class="rect1"></div>
      <div class="rect2"></div>
      <div class="rect3"></div>
      <div class="rect4"></div>
      <div class="rect5"></div>
    </div>
    <span ng-show="coinbase.loading">Connecting to Coinbase...</span>
    <span ng-show="index.coinbaseLoading">{{index.coinbaseLoading}}</span>
    </div>
  </div>

  <div class="row" ng-show="index.coinbaseError || (index.coinbaseToken && !index.coinbaseAccount)">
    <div class="m20b box-notification" ng-show="index.coinbaseError">
      <ul class="no-bullet m0 text-warning size-12">
        <li ng-repeat="err in index.coinbaseError.errors" ng-bind-html="err.message"></li>
      </ul>
    </div>
    <div class="m20b box-notification" ng-show="index.coinbaseToken && !index.coinbaseAccount">
      <div class="text-warning">
        <span>Your primary account should be a WALLET. Set your wallet account as primary and try again.</span>
      </div>
    </div>
    <div class="m10t text-center">
      <button
        class="dark-gray outline round tiny"
        ng-click="index.initCoinbase(index.coinbaseToken)">
        Retry
      </button>
      <div class="m20t size-12">
        <a class="text-gray" ng-click="$root.go('preferencesCoinbase')">Preferences</a>
      </div>
    </div>
  </div>

  <div ng-if="!index.coinbaseToken && !index.coinbaseLoading && !index.coinbaseError" class="row">
    <div class="box-notification text-center size-12 text-warning" ng-show="index.coinbaseTestnet">
      <i class="fi-info"></i>
      Testnet wallets only work with Coinbase Sandbox Accounts
    </div>
    <div class="columns" ng-init="showOauthForm = false">
      <div class="text-center m20v">
        <img src="img/coinbase-logo.png" width="200">
      </div>
      <div class="text-center small-10 small-centered columns" ng-show="!showOauthForm">

        <p class="m20t text-gray size-12">Connect your Coinbase account to get started</p>

        <a class="button light-gray outline round small"
          ng-click="$root.openExternalLink(coinbase.getAuthenticateUrl(), '_system'); showOauthForm = true">
          Connect to Coinbase
        </a>
        <div>
          <a href ng-click="showOauthForm = true" class="text-gray size-12">
            Do you already have the Oauth Code?
          </a>
        </div>
      </div>
      <div class="text-center" ng-show="showOauthForm">
        <div class="text-left box-notification" ng-show="coinbase.error">
          <ul class="no-bullet m0 text-warning size-12">
            <li ng-repeat="err in coinbase.error.errors" ng-bind-html="err.message"></li>
          </ul>
        </div>
        <form name="oauthCodeForm" ng-submit="coinbase.submitOauthCode(code)" novalidate>
          <label>OAuth Code</label>
          <input type="text" ng-model="code" ng-disabled="coinbase.loading"
          ng-attr-placeholder="{{'Paste the authorization code here'}}" required>
          <input
            class="button expand round"
            ng-style="{'background-color': '#2b71b1'}"
            type="submit" value="Get started" ng-disabled="oauthCodeForm.$invalid || coinbase.loading">
        </form>
        <button class="button light-gray expand outline round"
          ng-click="showOauthForm = false; index.coinbaseError = null; coinbase.error = null">
          <i class="fi-arrow-left"></i> <span class="tu">Back</span>
        </button>
      </div>
    </div>
  </div>

  <div ng-if="(index.coinbaseToken && index.coinbaseAccount) || !index.coinbaseError">

    <div class="p20v text-center" ng-show="index.coinbaseAccount" ng-click="index.updateCoinbase({updateAccount: true})">
      <img src="img/coinbase-logo.png" width="100">
    </div>

    <div class="sub-header pointer" ng-show="index.coinbaseUser"  ng-click="$root.go('preferencesCoinbase')">
      <div class="left size-12">
        <b>
        {{index.coinbaseAccount.name}}
        </b>
        <br>
        {{index.coinbaseAccount.balance.amount}} {{index.coinbaseAccount.balance.currency}}
        <span class="label gray radius">
          {{index.coinbaseAccount.native_balance.amount}} {{index.coinbaseAccount.native_balance.currency}}
        </span>
      </div>
      <div class="right m5t">
        <i class="fi-widget size-16 text-gray"></i>
        <span class="right text-gray">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </div>
    </div>

    <ul ng-show="index.coinbaseAuthInfo" class="no-bullet m0 size-12">
      <li class="line-b line-t p15 pointer"
          ng-click="$root.go('buyCoinbase')">
        <img src="img/buy-bitcoin.svg" alt="buy bitcoin" width="30">
        <span class="m10 text-normal text-bold">Buy Bitcoin</span>
        <span class="right text-gray">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
      <li class="line-b p15 pointer"
          ng-click="$root.go('sellCoinbase')">
        <img src="img/sell-bitcoin.svg" alt="sell bitcoin" width="30">
        <span class="m10 text-normal text-bold">Sell Bitcoin</span>
        <span class="right text-gray">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
      <li class="line-b p15 pointer"
          ng-click="$root.go('receiveCoinbase')">
        <img src="img/icon-receive-history.svg" alt="receive" width="30">
        <span class="m10 text-normal text-bold">Transfer from Copay</span>
        <span class="right text-gray">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
      <li class="line-b p15 pointer"
          ng-click="$root.go('sendCoinbase')">
        <img src="img/icon-sent-history.svg" alt="send" width="30">
        <span class="m10 text-normal text-bold">Transfer to Copay</span>
        <span class="right text-gray">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
    </ul>

    <div ng-show="index.coinbaseTransactions">
      <h4 class="title">Activity</h4>

      <div ng-show="index.coinbaseTransactions && index.coinbaseTransactions.data.length == 0"
        class="size-12 p10 text-center text-gray">
        No activity in your account
      </div>
      <div ng-repeat="tx in index.coinbaseTransactions.data"
        ng-click="coinbase.openTxModal(index.coinbaseToken, tx)"
        class="row collapse last-transactions-content">
        <div class="large-2 medium-2 small-2 columns">
          <img src="img/bought.svg" alt="bought" width="30" ng-show="tx.type == 'buy' && tx.status == 'completed'">
          <img src="img/bought-pending.svg" alt="bought" width="24" ng-show="tx.type == 'buy' && tx.status == 'pending'">
          <img src="img/sold.svg" alt="bought" width="30" ng-show="tx.type == 'sell' && tx.status == 'completed'">
          <img src="img/sold-pending.svg" alt="bought" width="24" ng-show="tx.type == 'sell' && tx.status == 'pending'">
          <img src="img/icon-sent-history.svg" alt="sent" width="30" ng-show="tx.type == 'send' && tx.to">
          <img src="img/icon-receive-history.svg" alt="receive" width="30" ng-show="tx.type == 'send' && tx.from">
          <span ng-show="tx.type != 'buy' && tx.type != 'sell' && tx.type != 'send'">&nbsp;</span>
        </div>

        <div class="large-5 medium-5 small-5 columns">
          <div class="size-12 m5t">
            <span ng-show="tx.type == 'buy'">Bought</span>
            <span ng-show="tx.type == 'sell'">Sold</span>
            <span class="text-bold">{{tx.amount.amount}} {{tx.amount.currency}}</span>
          </div>
        </div>
        <div class="large-4 medium-4 small-4 columns text-right">
          <div class="m5t size-12 text-gray">
            <div ng-show="tx.status == 'completed'">
              <time ng-if="tx.created_at">{{tx.created_at | amTimeAgo}}</time>
            </div>
            <div ng-show="tx.status == 'pending'">
              <span class="label outline gray radius text-gray text-info" ng-if="tx.status == 'pending'">Processing</span>
            </div>
          </div>
        </div>
        <div class="large-1 medium-1 small-1 columns text-right">
          <i class="icon-arrow-right3 size-18"></i>
        </div>
      </div>
      <div class="m15 oh">
        <a class="text-gray size-12 text-left" 
           ng-if="index.coinbaseTransactions.pagination.previous_uri"
           ng-click="index.coinbaseTransactions = index.updateCoinbase(
           {pagination: index.coinbaseTransactions.pagination.previous_uri})">
          <i class="icon-arrow-left"></i>
          Previous page
        </a>
        <a class="text-gray size-12 right" 
           ng-if="index.coinbaseTransactions.pagination.next_uri"
           ng-click="index.coinbaseTransactions = index.updateCoinbase(
           {pagination: index.coinbaseTransactions.pagination.next_uri})">
          Next page
          <i class="icon-arrow-right"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="extra-margin-bottom"></div>
</div>
